{"paragraphs":[{"text":"%md\n###Explore data and derive key features\n**Lets explore the data which we registred in the previous sessio (i.e, AR Overdue Predcition - LoadData)**\nThe analysis is going to happen as of 1st jan 2017. It means that all the calculations related to date are logically going to be applied as of that date.","dateUpdated":"2017-04-02T01:51:15+0000","config":{"tableHide":false,"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"tableName","index":0,"aggr":"sum"}],"values":[{"name":"isTemporary","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"tableName","index":0,"aggr":"sum"},"yAxis":{"name":"isTemporary","index":1,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490867029853_-760307829","id":"20170312-170649_1135967226","result":{"code":"SUCCESS","type":"HTML","msg":"<h3>Explore data and derive key features</h3>\n<p><strong>Lets explore the data which we registred in the previous sessio (i.e, AR Overdue Predcition - LoadData)</strong>\n<br  />The analysis is going to happen as of 1st jan 2017. It means that all the calculations related to date are logically going to be applied as of that date.</p>\n"},"dateCreated":"2017-03-30T09:43:49+0000","dateStarted":"2017-04-02T07:17:04+0000","dateFinished":"2017-04-02T07:17:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:81","focus":true},{"text":"%pyspark\n\nfrom pyspark.sql import functions as F\nfrom  pyspark.sql.functions import datediff\nfrom pyspark.sql import HiveContext\nsqlContext = HiveContext(sc)\n\n#Load Data from saved table (from previous session)\ninvoicedetailsDF = sqlContext.sql('select documentnumber,documentdate,status,region,startdate,creditlimit,paymentterm,amount,date(\"2017-01-01\") as asOfDate,case when status=\"Open\" then 0 else 1 end as Overdue,case when status=\"Clossed\" then PaymentDate else date(\"2017-01-01\") end as PaymentDate from invoicedetails')\n\n#select only variable for analysis\ntobeAnalysedDF=invoicedetailsDF.select(\"documentnumber\",\"documentdate\",\"PaymentDate\",\"status\",\"region\",\"creditlimit\",\"paymentterm\",\"amount\",\ndatediff( invoicedetailsDF.PaymentDate,invoicedetailsDF.documentdate).alias(\"invoiceAge\"),\ndatediff( invoicedetailsDF.asOfDate,invoicedetailsDF.startdate).alias(\"relationshipAge\"),\n\"Overdue\")\n\nsqlc.registerDataFrameAsTable(tobeAnalysedDF, \"tobeAnalysedDF\")\nsqlc.sql(\"drop table\");\nsqlc.sql(\"create table tobeAnalysedDF as select * from tobeAnalysedDF\");\n","dateUpdated":"2017-04-05T09:35:24+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","tableHide":false,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"tableName","index":0,"aggr":"sum"}],"values":[{"name":"isTemporary","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"tableName","index":0,"aggr":"sum"},"yAxis":{"name":"isTemporary","index":1,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490867029853_-760307829","id":"20170312-172654_806834049","result":{"code":"ERROR","type":"TEXT","msg":"Traceback (most recent call last):\n  File \"/tmp/zeppelin_pyspark-2095340889639648557.py\", line 239, in <module>\n    eval(compiledCode)\n  File \"<string>\", line 11, in <module>\n  File \"/usr/hdp/current/spark-client/python/pyspark/sql/context.py\", line 580, in sql\n    return DataFrame(self._ssql_ctx.sql(sqlQuery), self)\n  File \"/usr/hdp/current/spark-client/python/lib/py4j-0.9-src.zip/py4j/java_gateway.py\", line 813, in __call__\n    answer, self.gateway_client, self.target_id, self.name)\n  File \"/usr/hdp/current/spark-client/python/pyspark/sql/utils.py\", line 51, in deco\n    raise AnalysisException(s.split(': ', 1)[1], stackTrace)\nAnalysisException: u'`default`.`tobeanalyseddf` already exists.;'\n"},"dateCreated":"2017-03-30T09:43:49+0000","dateStarted":"2017-04-05T09:34:22+0000","dateFinished":"2017-04-05T09:34:37+0000","status":"ERROR","progressUpdateIntervalMs":500,"$$hashKey":"object:82"},{"text":"%md\n###Explore and Generate relavent bins\n**Let us consider features like creditlimit, paymentterm, amount, invoiceAge and relationshipAge for variable generation for now.","dateUpdated":"2017-04-02T07:33:17+0000","config":{"colWidth":12,"editorMode":"ace/mode/sql","tableHide":false,"graph":{"mode":"table","height":300,"optionOpen":true,"keys":[{"name":"documentnumber","index":0,"aggr":"sum"}],"values":[{"name":"paymentdate","index":1,"aggr":"sum"}],"groups":[],"scatter":{"yAxis":{"name":"paymentdate","index":1,"aggr":"sum"},"xAxis":{"name":"documentnumber","index":0,"aggr":"sum"}}},"enabled":true,"editorHide":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490867029854_-759153582","id":"20170312-211730_56533309","result":{"code":"SUCCESS","type":"HTML","msg":"<h3>Explore and Generate relavent bins</h3>\n<p>**Let us consider features like creditlimit, paymentterm, amount, invoiceAge and relationshipAge for variable generation for now.</p>\n"},"dateCreated":"2017-03-30T09:43:49+0000","dateStarted":"2017-04-02T07:22:36+0000","dateFinished":"2017-04-02T07:22:36+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:83"},{"text":"%sql\n--select creditlimit ,sum(overdue) from tobeAnalysedDF group by creditlimit\nselect creditlimitBin,sum(Overdue) overdueCount,min(creditlimit) minimum,max(creditlimit) maximum from \n(select creditlimit,NTILE(5) over(order by creditlimit) as creditlimitBin,Overdue from tobeAnalysedDF)creditlimitInnerQuery\ngroup by creditlimitBin\n","dateUpdated":"2017-04-02T02:34:05+0000","config":{"colWidth":12,"tableHide":false,"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"keys":[{"name":"creditlimitBin","index":0,"aggr":"sum"}],"values":[{"name":"overdueCount","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"creditlimitBin","index":0,"aggr":"sum"},"yAxis":{"name":"overdueCount","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1490867029854_-759153582","id":"20170312-212755_477066908","result":{"code":"SUCCESS","type":"TABLE","msg":"creditlimitBin\toverdueCount\tminimum\tmaximum\n1\t414\t3.954372447\t3567.465953\n2\t391\t3567.465953\t7539.089743\n3\t382\t7539.089743\t15517.24492\n4\t412\t15517.24492\t40698.29605\n5\t388\t40698.29605\t3255563.563\n","comment":"","msgTable":[[{"key":"overdueCount","value":"1"},{"key":"overdueCount","value":"414"},{"key":"overdueCount","value":"3.954372447"},{"key":"overdueCount","value":"3567.465953"}],[{"key":"minimum","value":"2"},{"key":"minimum","value":"391"},{"key":"minimum","value":"3567.465953"},{"key":"minimum","value":"7539.089743"}],[{"key":"maximum","value":"3"},{"key":"maximum","value":"382"},{"key":"maximum","value":"7539.089743"},{"key":"maximum","value":"15517.24492"}],[{"value":"4"},{"value":"412"},{"value":"15517.24492"},{"value":"40698.29605"}],[{"value":"5"},{"value":"388"},{"value":"40698.29605"},{"value":"3255563.563"}]],"columnNames":[{"name":"creditlimitBin","index":0,"aggr":"sum"},{"name":"overdueCount","index":1,"aggr":"sum"},{"name":"minimum","index":2,"aggr":"sum"},{"name":"maximum","index":3,"aggr":"sum"}],"rows":[["1","414","3.954372447","3567.465953"],["2","391","3567.465953","7539.089743"],["3","382","7539.089743","15517.24492"],["4","412","15517.24492","40698.29605"],["5","388","40698.29605","3255563.563"]]},"dateCreated":"2017-03-30T09:43:49+0000","dateStarted":"2017-04-02T02:18:59+0000","dateFinished":"2017-04-02T02:19:00+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:84"},{"text":"%sql\n--select creditlimit ,sum(overdue) from tobeAnalysedDF group by creditlimit\nselect paymenttermBin,sum(overdue) overdueCount,min(paymentterm) as minimum,max(paymentterm) as maximum from (select paymentterm,NTILE(3) over(order by paymentterm) as paymenttermBin,Overdue from tobeAnalysedDF)innerQuery group by paymenttermBin","dateUpdated":"2017-04-02T02:34:06+0000","config":{"colWidth":12,"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"keys":[{"name":"paymenttermBin","index":0,"aggr":"sum"}],"values":[{"name":"overdueCount","index":1,"aggr":"sum"}],"groups":[],"scatter":{"yAxis":{"name":"overdueCount","index":1,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1491118137424_1295864548","id":"20170402-072857_519246783","result":{"code":"SUCCESS","type":"TABLE","msg":"paymenttermBin\toverdueCount\tminimum\tmaximum\n1\t656\t1\t76\n2\t695\t76\t177\n3\t636\t177\t250\n","comment":"","msgTable":[[{"key":"overdueCount","value":"1"},{"key":"overdueCount","value":"656"},{"key":"overdueCount","value":"1"},{"key":"overdueCount","value":"76"}],[{"key":"minimum","value":"2"},{"key":"minimum","value":"695"},{"key":"minimum","value":"76"},{"key":"minimum","value":"177"}],[{"key":"maximum","value":"3"},{"key":"maximum","value":"636"},{"key":"maximum","value":"177"},{"key":"maximum","value":"250"}]],"columnNames":[{"name":"paymenttermBin","index":0,"aggr":"sum"},{"name":"overdueCount","index":1,"aggr":"sum"},{"name":"minimum","index":2,"aggr":"sum"},{"name":"maximum","index":3,"aggr":"sum"}],"rows":[["1","656","1","76"],["2","695","76","177"],["3","636","177","250"]]},"dateCreated":"2017-04-02T07:28:57+0000","dateStarted":"2017-04-02T01:48:12+0000","dateFinished":"2017-04-02T01:48:13+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:85"},{"text":"%sql\n--select creditlimit ,sum(overdue) from tobeAnalysedDF group by creditlimit\nselect amountBin,sum(overdue) overdueCount,min(amount) as minimum,max(amount) as maximum from (select amount,NTILE(5) over(order by amount) as amountBin,Overdue from tobeAnalysedDF)innerQuery group by amountBin","dateUpdated":"2017-04-02T02:34:08+0000","config":{"colWidth":12,"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"keys":[{"name":"amountBin","index":0,"aggr":"sum"}],"values":[{"name":"overdueCount","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"amountBin","index":0,"aggr":"sum"},"yAxis":{"name":"overdueCount","index":1,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1491128702187_-1970312514","id":"20170402-102502_1959183336","result":{"code":"SUCCESS","type":"TABLE","msg":"amountBin\toverdueCount\tminimum\tmaximum\n1\t403\t0.284792306\t3413.681022\n2\t373\t3428.454579\t12493.93416\n3\t417\t12570.9026\t33775.1718\n4\t381\t33835.99587\t92049.4666\n5\t413\t92119.2765\t2.124121368E7\n","comment":"","msgTable":[[{"key":"overdueCount","value":"1"},{"key":"overdueCount","value":"403"},{"key":"overdueCount","value":"0.284792306"},{"key":"overdueCount","value":"3413.681022"}],[{"key":"minimum","value":"2"},{"key":"minimum","value":"373"},{"key":"minimum","value":"3428.454579"},{"key":"minimum","value":"12493.93416"}],[{"key":"maximum","value":"3"},{"key":"maximum","value":"417"},{"key":"maximum","value":"12570.9026"},{"key":"maximum","value":"33775.1718"}],[{"value":"4"},{"value":"381"},{"value":"33835.99587"},{"value":"92049.4666"}],[{"value":"5"},{"value":"413"},{"value":"92119.2765"},{"value":"2.124121368E7"}]],"columnNames":[{"name":"amountBin","index":0,"aggr":"sum"},{"name":"overdueCount","index":1,"aggr":"sum"},{"name":"minimum","index":2,"aggr":"sum"},{"name":"maximum","index":3,"aggr":"sum"}],"rows":[["1","403","0.284792306","3413.681022"],["2","373","3428.454579","12493.93416"],["3","417","12570.9026","33775.1718"],["4","381","33835.99587","92049.4666"],["5","413","92119.2765","2.124121368E7"]]},"dateCreated":"2017-04-02T10:25:02+0000","dateStarted":"2017-04-02T01:48:46+0000","dateFinished":"2017-04-02T01:48:46+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:86"},{"text":"%sql\n--select creditlimit ,sum(overdue) from tobeAnalysedDF group by creditlimit\nselect invoiceAgeBin,sum(overdue) overdueCount,min(invoiceAge) as minimum,max(invoiceAge) as maximum from (select invoiceAge,NTILE(3) over(order by invoiceAge) as invoiceAgeBin,Overdue from tobeAnalysedDF)innerQuery group by invoiceAgeBin","dateUpdated":"2017-04-02T02:34:11+0000","config":{"colWidth":12,"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"keys":[{"name":"invoiceAgeBin","index":0,"aggr":"sum"}],"values":[{"name":"overdueCount","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"invoiceAgeBin","index":0,"aggr":"sum"},"yAxis":{"name":"overdueCount","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1491129470858_1553136359","id":"20170402-103750_1495564373","result":{"code":"SUCCESS","type":"TABLE","msg":"invoiceAgeBin\toverdueCount\tminimum\tmaximum\n1\t1334\t-385\t347\n2\t631\t347\t1443\n3\t22\t1443\t32889\n","comment":"","msgTable":[[{"key":"overdueCount","value":"1"},{"key":"overdueCount","value":"1334"},{"key":"overdueCount","value":"-385"},{"key":"overdueCount","value":"347"}],[{"key":"minimum","value":"2"},{"key":"minimum","value":"631"},{"key":"minimum","value":"347"},{"key":"minimum","value":"1443"}],[{"key":"maximum","value":"3"},{"key":"maximum","value":"22"},{"key":"maximum","value":"1443"},{"key":"maximum","value":"32889"}]],"columnNames":[{"name":"invoiceAgeBin","index":0,"aggr":"sum"},{"name":"overdueCount","index":1,"aggr":"sum"},{"name":"minimum","index":2,"aggr":"sum"},{"name":"maximum","index":3,"aggr":"sum"}],"rows":[["1","1334","-385","347"],["2","631","347","1443"],["3","22","1443","32889"]]},"dateCreated":"2017-04-02T10:37:50+0000","dateStarted":"2017-04-02T01:47:34+0000","dateFinished":"2017-04-02T01:47:34+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:87"},{"text":"%sql\nselect relationshipAgeBin,sum(overdue) overdueCount,min(relationshipAge) as minimum,max(relationshipAge) as maximum from (select relationshipAge,NTILE(3) over(order by relationshipAge) as relationshipAgeBin,Overdue from tobeAnalysedDF)innerQuery group by relationshipAgeBin\n","dateUpdated":"2017-04-02T02:34:18+0000","config":{"colWidth":12,"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"keys":[{"name":"relationshipAgeBin","index":0,"aggr":"sum"}],"values":[{"name":"overdueCount","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"relationshipAgeBin","index":0,"aggr":"sum"},"yAxis":{"name":"overdueCount","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1491129558277_-507255298","id":"20170402-103918_1786608656","result":{"code":"SUCCESS","type":"TABLE","msg":"relationshipAgeBin\toverdueCount\tminimum\tmaximum\n1\t650\t3623\t5461\n2\t685\t5461\t6209\n3\t652\t6209\t8036\n","comment":"","msgTable":[[{"key":"overdueCount","value":"1"},{"key":"overdueCount","value":"650"},{"key":"overdueCount","value":"3623"},{"key":"overdueCount","value":"5461"}],[{"key":"minimum","value":"2"},{"key":"minimum","value":"685"},{"key":"minimum","value":"5461"},{"key":"minimum","value":"6209"}],[{"key":"maximum","value":"3"},{"key":"maximum","value":"652"},{"key":"maximum","value":"6209"},{"key":"maximum","value":"8036"}]],"columnNames":[{"name":"relationshipAgeBin","index":0,"aggr":"sum"},{"name":"overdueCount","index":1,"aggr":"sum"},{"name":"minimum","index":2,"aggr":"sum"},{"name":"maximum","index":3,"aggr":"sum"}],"rows":[["1","650","3623","5461"],["2","685","5461","6209"],["3","652","6209","8036"]]},"dateCreated":"2017-04-02T10:39:18+0000","dateStarted":"2017-04-02T02:25:27+0000","dateFinished":"2017-04-02T02:25:28+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:88"},{"text":"%sql\nselect region,sum(overdue) overdueCount from tobeAnalysedDF group by region","dateUpdated":"2017-04-02T02:35:22+0000","config":{"colWidth":12,"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"keys":[{"name":"region","index":0,"aggr":"sum"}],"values":[{"name":"overdueCount","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"region","index":0,"aggr":"sum"},"yAxis":{"name":"overdueCount","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1491134881684_-404776415","id":"20170402-120801_1261406142","result":{"code":"SUCCESS","type":"TABLE","msg":"region\toverdueCount\nNortheastern\t82\nEastern\t254\nCentral\t133\nSouthern\t451\nWestern\t497\nNorthern\t570\n","comment":"","msgTable":[[{"key":"overdueCount","value":"Northeastern"},{"key":"overdueCount","value":"82"}],[{"value":"Eastern"},{"value":"254"}],[{"value":"Central"},{"value":"133"}],[{"value":"Southern"},{"value":"451"}],[{"value":"Western"},{"value":"497"}],[{"value":"Northern"},{"value":"570"}]],"columnNames":[{"name":"region","index":0,"aggr":"sum"},{"name":"overdueCount","index":1,"aggr":"sum"}],"rows":[["Northeastern","82"],["Eastern","254"],["Central","133"],["Southern","451"],["Western","497"],["Northern","570"]]},"dateCreated":"2017-04-02T12:08:01+0000","dateStarted":"2017-04-02T02:35:16+0000","dateFinished":"2017-04-02T02:35:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:89"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1491143716136_-774356778","id":"20170402-143516_2123969633","dateCreated":"2017-04-02T02:35:16+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:90"}],"name":"Explore Data","id":"2CDZBBJUW","angularObjects":{"2BYG9GAN3:shared_process":[],"2C139U1BG:shared_process":[],"2BYWWZJPK:shared_process":[],"2C2VAKPN2:shared_process":[],"2BZC2RPUW:shared_process":[],"2BZQEH9EH:shared_process":[]},"config":{"looknfeel":"default"},"info":{}}